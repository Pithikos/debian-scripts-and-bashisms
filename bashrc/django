#
# This script will add the following:
#   * Populate DJANGO_MANAGE_MODULE when in a Django project
#   * Add aliases:
#		  - shell
#     - root
#     - mkmig
#     - mig
#


_django_shell='shell_plus'


_upfind_file(){
	_dir=`pwd`
	while [[ "$_dir" != "/" ]] ; do
		guess_path="$_dir"/"$1"
		if [[ -f "$guess_path" ]]; then
			echo "$guess_path"
			return 0
		fi
		_dir=`dirname "$_dir"`
	done
	return 1
}


shell(){
	if [[ "$DJANGO_MANAGE_MODULE" ]]; then
		python "$DJANGO_MANAGE_MODULE" "$_django_shell"
	else
		echo "No manage.py file found"
	fi
}


root(){
	if [[ "$DJANGO_MANAGE_MODULE" ]]; then
		cd "$(dirname "$DJANGO_MANAGE_MODULE")"
	else
		echo "Not a django project"
	fi
}


_try_run_django_command(){
	if [[ "$DJANGO_MANAGE_MODULE" ]]; then
		"$@"
	else
		echo "Not a django project."
	fi
}


# Django shortcuts

alias makemigrations='_try_run_django_command python "$DJANGO_MANAGE_MODULE" makemigrations'
alias migrate='_try_run_django_command python "$DJANGO_MANAGE_MODULE" migrate'
alias mig='migrate'
alias mkmig='makemigrations'
